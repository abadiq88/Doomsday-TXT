<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù†Ø³Ø® ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ø¹ Ø²Ø®Ø§Ø±Ù ÙˆÙƒÙŠØ¨ÙˆØ±Ø¯ (Ù…ÙØ­Ø³Ù‘Ù†)</title>
  <!-- CSS Ø§Ù„Ù…ÙƒØªØ¨Ø© -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/simple-keyboard@3.8.30/build/css/index.css"
  />
  <style>
    body {
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
      color: #e0e0e0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      text-align: center;
      padding: 15px;
      margin: 0;
      font-size: 13px;
      min-height: 100vh;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 15px;
      background: rgba(30, 30, 46, 0.7);
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    h2 {
      font-size: 16px;
      margin-bottom: 10px;
      color: #4fc3f7;
      text-shadow: 0 0 10px rgba(79, 195, 247, 0.3);
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(79, 195, 247, 0.3);
    }
    
    .controls-row {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }
    
    select {
      font-size: 13px;
      padding: 8px 12px;
      border-radius: 8px;
      background: rgba(40, 40, 60, 0.8);
      color: #e0e0e0;
      border: 1px solid rgba(79, 195, 247, 0.3);
      min-width: 200px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    select:hover {
      border-color: #4fc3f7;
      box-shadow: 0 0 8px rgba(79, 195, 247, 0.2);
    }
    
    .btn {
      background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
      color: white;
      border: none;
      padding: 8px 16px;
      font-size: 13px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 6px;
      min-width: 100px;
      justify-content: center;
    }
    
    .btn:hover {
      background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    .btn-convert {
      background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
    }
    
    .btn-convert:hover {
      background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
      box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #c0392b 0%, #e74c3c 100%);
    }
    
    .btn-danger:hover {
      background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
      box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
    }
    
    .btn-info {
      background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%);
    }
    
    .btn-info:hover {
      background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
      box-shadow: 0 4px 12px rgba(155, 89, 182, 0.3);
    }
    
    textarea {
      width: 100%;
      height: 120px;
      font-size: 14px;
      direction: rtl;
      padding: 12px;
      border-radius: 8px;
      background: rgba(25, 25, 35, 0.8);
      color: #ffffff;
      border: 2px solid rgba(79, 195, 247, 0.2);
      resize: vertical;
      margin-bottom: 15px;
      transition: border-color 0.3s;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    textarea:focus {
      outline: none;
      border-color: #4fc3f7;
      box-shadow: 0 0 12px rgba(79, 195, 247, 0.2);
    }
    
    .info-bar {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 15px;
      margin-top: 15px;
      flex-wrap: wrap;
      padding: 12px;
      background: rgba(40, 40, 60, 0.5);
      border-radius: 8px;
    }
    
    .char {
      color: #0f0;
      font-size: 13px;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .msg {
      font-size: 13px;
      color: #ccc;
      min-height: 20px;
      padding: 4px 8px;
      border-radius: 4px;
      background: rgba(0, 0, 0, 0.2);
    }
    
    .flash-success {
      animation: flashGreen 0.5s ease-in-out 2;
    }
    
    .flash-fail {
      animation: flashRed 0.5s ease-in-out 2;
    }
    
    @keyframes flashGreen {
      0% { background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); }
      50% { background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); }
      100% { background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); }
    }
    
    @keyframes flashRed {
      0% { background: linear-gradient(135deg, #c0392b 0%, #e74c3c 100%); }
      50% { background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); }
      100% { background: linear-gradient(135deg, #c0392b 0%, #e74c3c 100%); }
    }

    /* Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© */
    .simple-keyboard {
      direction: ltr !important;
      margin-top: 20px;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
    }
    
    #keyboard {
      display: none;
    }

    /* ØªØ®ØµÙŠØµ Ø£Ù„ÙˆØ§Ù† Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯ */
    .simple-keyboard .hg-button {
      background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%) !important;
      color: #e0e0e0 !important;
      border: 1px solid rgba(79, 195, 247, 0.2) !important;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
      transition: all 0.2s !important;
    }
    
    .simple-keyboard .hg-button:hover {
      background: linear-gradient(135deg, #3498db 0%, #2980b9 100%) !important;
      transform: translateY(-1px);
    }
    
    .simple-keyboard .hg-button:active {
      transform: translateY(1px);
    }
    
    .simple-keyboard .hg-button.btn-active {
      background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%) !important;
    }
    
    .footer {
      margin-top: 20px;
      font-size: 11px;
      color: #666;
      opacity: 0.7;
    }
    
    /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ù„Ù„Ø²Ø± Ø§Ù„Ù…ØªØ­Ø±Ùƒ */
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .btn-pulse {
      animation: pulse 2s infinite;
    }
    
    /* ØªØ®ØµÙŠØµ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
    ::-webkit-scrollbar {
      width: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(40, 40, 60, 0.5);
    }
    
    ::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #2980b9 0%, #3498db 100%);
    }
    
    /* ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨ */
    @media (max-width: 768px) {
      .container {
        padding: 10px;
        margin: 5px;
      }
      
      .controls-row {
        flex-direction: column;
        align-items: center;
      }
      
      select, .btn {
        width: 100%;
        max-width: 300px;
      }
      
      .simple-keyboard {
        max-width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>âœï¸ Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ ÙÙ‚Ø·ØŒ ÙˆØ§Ø®ØªØ± Ø§Ù„Ø²Ø®Ø±ÙØ©ØŒ ÙˆØ³ÙŠØªÙ… Ù†Ø³Ø®Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ â¬†ï¸</h2>
    
    <div class="controls-row">
      <select id="decoration">
        <option value="">Ø¨Ø¯ÙˆÙ† Ø²Ø®Ø±ÙØ©</option>
        <option value="â˜…å½¡">â˜…å½¡ ... å½¡â˜…</option>
        <option value="ğ“†©">ğ“†© ... ğ“†ª</option>
        <option value="â™›">â™› ... â™›</option>
        <option value="ê§">ê§ ... ê§‚</option>
        <option value="â¸™">â¸™ ... â¸™</option>
        <option value="ä¹‚">ä¹‚ ... ä¹‚</option>
        <option value="ğŸ”ª">ğŸ”ª ... ğŸ”ª</option>
        <option value="ğŸª–">ğŸª– ... ğŸª–</option>
        <option value="ğŸ”«">ğŸ”« ... ğŸ”«</option>
        <option value="ï¸»ãƒ‡â•ä¸€">ï¸»ãƒ‡â•ä¸€ ... ï¸»ãƒ‡â•ä¸€</option>
        <option value="å½¡â˜…åˆ€â˜…å½¡">å½¡â˜…åˆ€â˜…å½¡ ... å½¡â˜…åˆ€â˜…å½¡</option>
        <option value="ï¸»â•¦ÌµÌµÍ‡Ì¿Ì¿Ì¿Ì¿â•¤â”€â”€">ï¸»â•¦ÌµÌµÍ‡Ì¿Ì¿Ì¿Ì¿â•¤â”€â”€ ... ï¸»â•¦ÌµÌµÍ‡Ì¿Ì¿Ì¿Ì¿â•¤â”€â”€</option>
        <option value="ê§ğ“Šˆğ’†œâ¸¸â¸¸â¸¸ğ’†œğ“Š‰ê§‚">ê§ğ“Šˆğ’†œâ¸¸â¸¸â¸¸ğ’†œğ“Š‰ê§‚ ... ê§ğ“Šˆğ’†œâ¸¸â¸¸â¸¸ğ’†œğ“Š‰ê§‚</option>
        <option value="åæˆ°å">åæˆ°å ... åæˆ°å</option>
        <option value="ä¹‚â¸¸ä¹‚">ä¹‚â¸¸ä¹‚ ... ä¹‚â¸¸ä¹‚</option>
        <option value="â¸¸ğ“†©âš”ï¸ğ“†ªâ¸¸">â¸¸ğ“†©âš”ï¸ğ“†ªâ¸¸ ... â¸¸ğ“†©âš”ï¸ğ“†ªâ¸¸</option>
        <option value="ğŸ—¡ï¸">ğŸ—¡ï¸ ... ğŸ—¡ï¸</option>
        <option value="ğŸ’£">ğŸ’£ ... ğŸ’£</option>
        <option value="âš”ï¸">âš”ï¸ ... âš”ï¸</option>
        <option value="ğŸ›¡ï¸">ğŸ›¡ï¸ ... ğŸ›¡ï¸</option>
        <option value="ğŸš">ğŸš ... ğŸš</option>
        <option value="ğŸ¯">ğŸ¯ ... ğŸ¯</option>
        <option value="ğŸ”°">ğŸ”° ... ğŸ”°</option>
        <option value="â˜ ï¸">â˜ ï¸ ... â˜ ï¸</option>
        <option value="âœ¦">âœ¦ ... âœ¦</option>
        <option value="à¼’">à¼’ ... à¼’</option>
        <option value="âœª">âœª ... âœª</option>
        <option value="â³">â³ ... â³</option>
        <option value="âœ˜">âœ˜ ... âœ˜</option>
        <option value="å">å ... å</option>
      </select>
      
      <button class="btn btn-convert" onclick="convertArabicEnglish()">
        <span>ğŸ”„</span> Ø¹Ø±Ø¨ÙŠ â†” Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ
      </button>
    </div>
    
    <textarea id="myText" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§... Ø³ÙŠØªÙ… Ø§Ù„Ù†Ø³Ø® ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ ØªØ±Ùƒ Ø§Ù„Ù†Ø§ÙØ°Ø©"></textarea>
    
    <div class="info-bar">
      <div class="char" id="charCount">ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø­Ø±Ù: 0</div>
      <button class="btn" id="copyBtn" onclick="copyText()">
        <span>ğŸ“‹</span> Ù†Ø³Ø®
      </button>
      <button class="btn btn-danger" onclick="clearText()">
        <span>ğŸ§¹</span> Ù…Ø³Ø­
      </button>
      <button class="btn btn-info" onclick="openMiniWindow()">
        <span>ğŸªŸ</span> Ù†Ø§ÙØ°Ø© ØµØºÙŠØ±Ø©
      </button>
      <button class="btn" id="toggle-btn">
        <span>âŒ¨ï¸</span> ÙƒÙŠØ¨ÙˆØ±Ø¯
      </button>
      <div class="msg" id="msg">...</div>
    </div>
    
    <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù…ÙƒØªØ¨Ø© Ù„Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯ -->
    <div id="keyboard" class="simple-keyboard"></div>
    
    <div class="footer">
      âš¡ Ø§Ø³ØªØ®Ø¯Ø§Ù… Clipboard API Ø§Ù„Ø­Ø¯ÙŠØ«Ø© Ù…Ø¹ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ
    </div>
  </div>

  <!-- Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ù…ÙƒØªØ¨Ø© -->
  <script src="https://cdn.jsdelivr.net/npm/simple-keyboard@3.8.30/build/index.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const textarea   = document.getElementById('myText');
      const msg        = document.getElementById('msg');
      const charCount  = document.getElementById('charCount');
      const copyBtn    = document.getElementById('copyBtn');
      const decoration = document.getElementById('decoration');
      const toggleBtn  = document.getElementById('toggle-btn');
      const kbRoot     = document.getElementById('keyboard');
      const Keyboard   = window.SimpleKeyboard.default;

      let isPopup = window.opener !== null;
      let lastCopiedText = '';
      let autoCopyEnabled = true;

      // ØªØ£Ø«ÙŠØ± Ø§Ù„ÙˆÙ…ÙŠØ¶
      function flashEffect(cls) {
        copyBtn.classList.remove('flash-success','flash-fail');
        void copyBtn.offsetWidth;
        copyBtn.classList.add(cls);
        setTimeout(() => copyBtn.classList.remove(cls), 2000);
      }

      // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†Øµ Ù…Ø¹ Ø§Ù„Ø²Ø®Ø±ÙØ©
      function getDecoratedText() {
        const deco = decoration.value;
        const text = textarea.value.trim();
        if (!text) return '';
        return deco
          ? `${deco} ${text} ${flipDecoration(deco)}`
          : text;
      }

      // Ù‚Ù„Ø¨ Ø§Ù„Ø²Ø®Ø§Ø±Ù Ø§Ù„Ù…Ø¹Ø±ÙˆÙØ©
      function flipDecoration(d) {
        if (d === "â˜…å½¡") return "å½¡â˜…";
        if (d === "ğ“†©") return "ğ“†ª";
        if (d === "ê§") return "ê§‚";
        return d;
      }

      // Ø¯Ø§Ù„Ø© ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ â†” Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
      window.convertArabicEnglish = function() {
        const text = textarea.value;
        if (!text.trim()) {
          msg.innerHTML = 'âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Øµ Ù„Ù„ØªØ­ÙˆÙŠÙ„';
          return;
        }
        
        let convertedText = '';
        let conversionType = '';
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ Ø§Ù„Ù†Øµ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø­Ø±Ù Ø¹Ø±Ø¨ÙŠØ©
        const hasArabic = /[\u0600-\u06FF]/.test(text);
        const hasEnglish = /[A-Za-z]/.test(text);
        
        if (hasArabic && hasEnglish) {
          // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù†Øµ Ù…Ø®ØªÙ„Ø·Ø§Ù‹ØŒ Ù†Ø¹ÙƒØ³ ÙƒÙ„ Ø­Ø±Ù Ø¹Ù„Ù‰ Ø­Ø¯Ø©
          for (let char of text) {
            const arabicEquivalent = englishToArabicMap[char.toLowerCase()] || 
                                   arabicToEnglishMap[char] || char;
            convertedText += arabicEquivalent;
          }
          conversionType = 'Ù…Ø®ØªÙ„Ø· â†” Ù…Ø®ØªÙ„Ø·';
        } else if (hasArabic) {
          // ØªØ­ÙˆÙŠÙ„ Ø¹Ø±Ø¨ÙŠ Ø¥Ù„Ù‰ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ
          for (let char of text) {
            convertedText += arabicToEnglishMap[char] || char;
          }
          conversionType = 'Ø¹Ø±Ø¨ÙŠ â†’ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ';
        } else {
          // ØªØ­ÙˆÙŠÙ„ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ Ø¥Ù„Ù‰ Ø¹Ø±Ø¨ÙŠ
          for (let char of text.toLowerCase()) {
            convertedText += englishToArabicMap[char] || char;
          }
          conversionType = 'Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ â†’ Ø¹Ø±Ø¨ÙŠ';
        }
        
        textarea.value = convertedText;
        updateCount();
        keyboard.setInput(convertedText);
        
        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„
        msg.innerHTML = `ğŸ”„ ${conversionType}`;
        setTimeout(() => {
          if (msg.innerHTML.includes('ğŸ”„')) msg.innerHTML = '...';
        }, 3000);
      };

      // Ø®Ø±ÙŠØ·Ø© ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
      const englishToArabicMap = {
        'a': 'Ø§', 'b': 'Ø¨', 'c': 'Ø³', 'd': 'Ø¯', 'e': 'ÙŠ',
        'f': 'Ù', 'g': 'Ø¬', 'h': 'Ù‡', 'i': 'ÙŠ', 'j': 'Ø¬',
        'k': 'Ùƒ', 'l': 'Ù„', 'm': 'Ù…', 'n': 'Ù†', 'o': 'Ùˆ',
        'p': 'Ø¨', 'q': 'Ù‚', 'r': 'Ø±', 's': 'Ø³', 't': 'Øª',
        'u': 'Ùˆ', 'v': 'Ù', 'w': 'Ùˆ', 'x': 'ÙƒØ³', 'y': 'ÙŠ',
        'z': 'Ø²'
      };

      // Ø®Ø±ÙŠØ·Ø© ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
      const arabicToEnglishMap = {
        'Ø§': 'a', 'Ø£': 'a', 'Ø¥': 'e', 'Ø¢': 'a',
        'Ø¨': 'b', 'Øª': 't', 'Ø«': 'th',
        'Ø¬': 'j', 'Ø­': 'h', 'Ø®': 'kh',
        'Ø¯': 'd', 'Ø°': 'dh', 'Ø±': 'r', 'Ø²': 'z',
        'Ø³': 's', 'Ø´': 'sh',
        'Øµ': 's', 'Ø¶': 'd',
        'Ø·': 't', 'Ø¸': 'z',
        'Ø¹': 'a', 'Øº': 'gh',
        'Ù': 'f', 'Ù‚': 'q',
        'Ùƒ': 'k', 'Ù„': 'l',
        'Ù…': 'm', 'Ù†': 'n',
        'Ù‡': 'h', 'Ùˆ': 'w', 'ÙŠ': 'y'
      };

      // Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Clipboard API Ø§Ù„Ø­Ø¯ÙŠØ«Ø©
      window.copyText = async function() {
        const decoratedText = getDecoratedText();
        if (!decoratedText) {
          msg.innerHTML = 'âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Øµ Ù„Ù„Ù†Ø³Ø®!';
          flashEffect('flash-fail');
          return;
        }
        
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù†Øµ Ù†ÙØ³Ù‡ Ø§Ù„Ù…Ù†Ø³ÙˆØ® Ù…Ø³Ø¨Ù‚Ø§Ù‹
        if (lastCopiedText === decoratedText) {
          msg.innerHTML = 'ğŸ“‹ Ø§Ù„Ù†Øµ Ù…Ù†Ø³ÙˆØ® Ù…Ø³Ø¨Ù‚Ø§Ù‹!';
          return;
        }
        
        try {
          // Ø§Ø³ØªØ®Ø¯Ø§Ù… Clipboard API Ø§Ù„Ø­Ø¯ÙŠØ«Ø© (Ø§Ù„Ø£ÙØ¶Ù„)
          await navigator.clipboard.writeText(decoratedText);
          lastCopiedText = decoratedText;
          msg.innerHTML = 'âœ”ï¸ ØªÙ… Ø§Ù„Ù†Ø³Ø® Ù…Ø¹ Ø§Ù„Ø²Ø®Ø±ÙØ©!';
          flashEffect('flash-success');
          
          // Ø¹Ø±Ø¶ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ù†Ø³ÙˆØ®
          const preview = decoratedText.length > 50 
            ? decoratedText.substring(0, 50) + '...' 
            : decoratedText;
          console.log('âœ… ØªÙ… Ù†Ø³Ø®:', preview);
        } catch (err) {
          console.error('âŒ ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø® Ø¨Ù€ Clipboard API:', err);
          // Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙƒÙ†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
          fallbackCopyText(decoratedText);
        }
      };

      // Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
      function fallbackCopyText(text) {
        const temp = document.createElement('textarea');
        temp.value = text;
        temp.style.position = 'fixed';
        temp.style.opacity = '0';
        document.body.appendChild(temp);
        temp.select();
        temp.setSelectionRange(0, 99999);
        
        try {
          const success = document.execCommand('copy');
          if (success) {
            lastCopiedText = text;
            msg.innerHTML = 'âœ”ï¸ ØªÙ… Ø§Ù„Ù†Ø³Ø® (Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©)!';
            flashEffect('flash-success');
          } else {
            msg.innerHTML = 'âŒ ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®!';
            flashEffect('flash-fail');
          }
        } catch (err) {
          msg.innerHTML = 'âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø³Ø®!';
          flashEffect('flash-fail');
        } finally {
          document.body.removeChild(temp);
        }
      }

      // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚Ù„
      window.clearText = function() {
        textarea.value = '';
        lastCopiedText = '';
        updateCount();
        keyboard.setInput('');
        msg.innerHTML = 'ğŸ§¹ ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ù†Øµ';
        setTimeout(() => {
          if (msg.innerHTML === 'ğŸ§¹ ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ù†Øµ') msg.innerHTML = '...';
        }, 2000);
      };

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯
      function updateCount() {
        const count = textarea.value.length;
        charCount.innerHTML = `ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø­Ø±Ù: ${count}`;
        
        // ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ† Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø­Ø±Ù
        if (count === 0) {
          charCount.style.color = '#ccc';
        } else if (count < 50) {
          charCount.style.color = '#0f0';
        } else if (count < 100) {
          charCount.style.color = '#ff0';
        } else {
          charCount.style.color = '#f00';
        }
      }

      // Ù†Ø§ÙØ°Ø© ØµØºÙŠØ±Ø©
      window.openMiniWindow = function() {
        if (!isPopup) {
          const features = `
            width=450,height=400,
            menubar=no,toolbar=no,
            location=no,status=no,
            scrollbars=yes,resizable=yes
          `;
          const newWindow = window.open(window.location.href, '_blank', features);
          
          if (newWindow) {
            msg.innerHTML = 'ğŸªŸ ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©';
          } else {
            msg.innerHTML = 'âŒ ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©';
          }
        } else {
          msg.innerHTML = 'âš ï¸ Ù‡Ø°Ù‡ Ù†Ø§ÙØ°Ø© ØµØºÙŠØ±Ø© Ø¨Ø§Ù„ÙØ¹Ù„';
        }
        
        setTimeout(() => {
          if (msg.innerHTML.includes('ğŸªŸ') || msg.innerHTML.includes('âš ï¸')) {
            msg.innerHTML = '...';
          }
        }, 3000);
      };

      // ØªØ¨Ø¯ÙŠÙ„ Ø¸Ù‡ÙˆØ± Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯
      function toggleKeyboard() {
        const isVisible = kbRoot.style.display === 'block';
        kbRoot.style.display = isVisible ? 'none' : 'block';
        toggleBtn.innerHTML = isVisible 
          ? '<span>âŒ¨ï¸</span> ÙƒÙŠØ¨ÙˆØ±Ø¯' 
          : '<span>âœ–ï¸</span> Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯';
        
        // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ù„Ù„Ø²Ø±
        toggleBtn.classList.add('btn-pulse');
        setTimeout(() => toggleBtn.classList.remove('btn-pulse'), 1000);
      }
      
      toggleBtn.addEventListener('click', toggleKeyboard);

      // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„ÙŠØ¯ÙˆÙŠØ©
      textarea.addEventListener('input', () => {
        keyboard.setInput(textarea.value);
        updateCount();
        lastCopiedText = ''; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¢Ø®Ø± Ù†Øµ Ù…Ù†Ø³ÙˆØ®
      });

      // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯ Ù…Ø¹ Ø§Ù„ØªØ®Ø·ÙŠØ·Ø§Øª
      const keyboard = new Keyboard({
        rootElement: '#keyboard',
        layout: {
          arabic: [
            "Ø¶ Øµ Ø« Ù‚ Ù Øº Ø¹ Ù‡ Ø® Ø­ Ø¬ Ø¯ {bksp}",
            "Ø´ Ø³ ÙŠ Ø¨ Ù„ Ø§ Øª Ù† Ù… Ùƒ Ø·",
            "Ø² Ø± Ø¡ Ø¤ Ø± Ù„Ø§ Ù‰ Ø© Ùˆ Ø² Ø¸",
            "{space} {lang} {sym} {enter}"
          ],
          english: [
            "` 1 2 3 4 5 6 7 8 9 0 - = {bksp}",
            "q w e r t y u i o p [ ] \\",
            "a s d f g h j k l ; '",
            "z x c v b n m , . /",
            "{space} {lang} {sym} {enter}"
          ],
          symbols: [
            "~ ! @ # $ % ^ & * ( ) _ + {bksp}",
            "- = { } [ ] \\ | ; : ' \"",
            "< > , . ? / `",
            "{space} {lang} {enter}"
          ]
        },
        layoutName: "arabic",
        display: {
          "{bksp}": "âŒ«",
          "{space}": "âµ",
          "{lang}": "Ø¹/EN",
          "{sym}": "#+=",
          "{enter}": "â†µ"
        },
        onChange: inputVal => {
          textarea.value = inputVal;
          updateCount();
          lastCopiedText = '';
        },
        onKeyPress: button => {
          if (button === "{bksp}") {
            const val = keyboard.getInput().slice(0, -1);
            keyboard.setInput(val);
            return;
          }
          if (button === "{lang}") {
            const current = keyboard.options.layoutName;
            const next = current === "arabic" ? "english" : "arabic";
            keyboard.setOptions({ layoutName: next });
            
            // ØªØ­Ø¯ÙŠØ« Ø²Ø± ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ©
            const langBtn = document.querySelector('[data-skbtn="{lang}"]');
            if (langBtn) {
              langBtn.textContent = next === "arabic" ? "Ø¹/EN" : "EN/Ø¹";
            }
            return;
          }
          if (button === "{sym}") {
            const curr = keyboard.options.layoutName;
            const next = curr === "symbols" ? "arabic" : "symbols";
            keyboard.setOptions({ layoutName: next });
            return;
          }
          if (button === "{enter}") {
            copyText();
            return;
          }
          if (button === "{space}") {
            keyboard.setInput(keyboard.getInput() + " ");
          }
        }
      });

      // Ø§Ù„Ù†Ø³Ø® Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ØªØ±Ùƒ Ø§Ù„Ù†Ø§ÙØ°Ø©
      window.addEventListener('blur', () => {
        if (autoCopyEnabled && textarea.value.trim() !== '') {
          setTimeout(() => {
            if (!document.hasFocus()) {
              copyText();
            }
          }, 500);
        }
      });
      
      document.addEventListener('visibilitychange', () => {
        if (autoCopyEnabled && document.hidden && textarea.value.trim() !== '') {
          setTimeout(() => copyText(), 300);
        }
      });

      // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø²Ø®Ø±ÙØ©
      decoration.addEventListener('change', () => {
        lastCopiedText = '';
        msg.innerHTML = 'âœ¨ ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø²Ø®Ø±ÙØ©';
        setTimeout(() => {
          if (msg.innerHTML === 'âœ¨ ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø²Ø®Ø±ÙØ©') msg.innerHTML = '...';
        }, 2000);
      });

      // Ø§Ø¨Ø¯Ø£ Ø¨Ø¹Ø¯Ø¯ Ù…Ø¨Ø¯Ø¦ÙŠ
      updateCount();
      
      // Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨
      setTimeout(() => {
        if (textarea.value === '') {
          msg.innerHTML = 'ğŸš€ Ø§Ø¨Ø¯Ø£ Ø¨Ø§Ù„ÙƒØªØ§Ø¨Ø©... Ø³ÙŠØªÙ… Ø§Ù„Ù†Ø³Ø® ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§';
        }
      }, 1000);
    });
  </script>
</body>
</html>