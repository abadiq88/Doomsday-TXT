<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù†Ø³Ø® ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ø¹ Ø²Ø®Ø§Ø±Ù ÙˆÙƒÙŠØ¨ÙˆØ±Ø¯</title>
  <!-- CSS Ø§Ù„Ù…ÙƒØªØ¨Ø© -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/simple-keyboard@3.8.30/build/css/index.css"
  />
  <style>
    body {
      background: #000;
      color: #fff;
      font-family: Tahoma, sans-serif;
      text-align: center;
      padding: 10px;
      margin: 0;
      font-size: 12px;
    }
    h2 {
      font-size: 14px;
      margin-bottom: 5px;
    }
    textarea {
      width: 95%;
      height: 100px;
      font-size: 14px;
      direction: rtl;
      padding: 6px;
      border-radius: 4px;
    }
    select {
      font-size: 12px;
      padding: 4px;
      margin: 5px 0;
    }
    .info-bar {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-top: 8px;
      flex-wrap: wrap;
    }
    .char {
      color: #0f0;
      font-size: 12px;
    }
    .msg {
      font-size: 12px;
      color: #ccc;
    }
    button {
      background-color: #444;
      color: white;
      border: none;
      padding: 4px 10px;
      font-size: 12px;
      border-radius: 4px;
      cursor: pointer;
      transition: 0.3s;
    }
    .flash-success {
      animation: flashGreen 0.4s ease-in-out 3;
    }
    .flash-fail {
      animation: flashRed 0.4s ease-in-out 3;
    }
    @keyframes flashGreen {
      0% { background-color: #0f0; color: #000; }
      50% { background-color: #222; color: #fff; }
      100% { background-color: #0f0; color: #000; }
    }
    @keyframes flashRed {
      0% { background-color: #f00; color: #fff; }
      50% { background-color: #222; color: #fff; }
      100% { background-color: #f00; color: #fff; }
    }

    /* Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© */
    .simple-keyboard {
      direction: ltr !important;       /* Ø¥Ø¬Ø¨Ø§Ø± LTR Ø­ØªÙ‰ Ù„Ø§ ØªÙ†Ø¹ÙƒØ³ Ø§Ù„ØµÙÙˆÙ */
      margin-top: 10px;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }
    /* Ù†Ø®ÙÙŠÙ‡Ø§ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
    #keyboard {
      display: none;
    }

    /* ØªØ®ØµÙŠØµ Ø£Ù„ÙˆØ§Ù† Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯ */
    .simple-keyboard .hg-button {
      background: #fff !important;
      color: #000 !important;
      border: 1px solid #666 !important;
      box-shadow: none !important;
    }
    .simple-keyboard .hg-button:hover {
      background: #f0f0f0 !important;
    }
  </style>
</head>
<body>
  <h2>âœï¸ Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ ÙÙ‚Ø·ØŒ ÙˆØ§Ø®ØªØ± Ø§Ù„Ø²Ø®Ø±ÙØ©ØŒ ÙˆØ³ÙŠØªÙ… Ù†Ø³Ø®Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ â¬†ï¸</h2>

  <select id="decoration">
    <option value="">Ø¨Ø¯ÙˆÙ† Ø²Ø®Ø±ÙØ©</option>
    <option value="â˜…å½¡">â˜…å½¡ ... å½¡â˜…</option>
    <option value="ğ“†©">ğ“†© ... ğ“†ª</option>
    <option value="â™›">â™› ... â™›</option>
    <option value="ê§">ê§ ... ê§‚</option>
    <option value="â¸™">â¸™ ... â¸™</option>
    <option value="ä¹‚">ä¹‚ ... ä¹‚</option>
    <option value="ğŸ”ª">ğŸ”ª ... ğŸ”ª</option>
    <option value="ğŸª–">ğŸª– ... ğŸª–</option>
    <option value="ğŸ”«">ğŸ”« ... ğŸ”«</option>
    <option value="ï¸»ãƒ‡â•ä¸€">ï¸»ãƒ‡â•ä¸€ ... ï¸»ãƒ‡â•ä¸€</option>
    <option value="å½¡â˜…åˆ€â˜…å½¡">å½¡â˜…åˆ€â˜…å½¡ ... å½¡â˜…åˆ€â˜…å½¡</option>
    <option value="ï¸»â•¦ÌµÌµÍ‡Ì¿Ì¿Ì¿Ì¿â•¤â”€â”€">ï¸»â•¦ÌµÌµÍ‡Ì¿Ì¿Ì¿Ì¿â•¤â”€â”€ ... ï¸»â•¦ÌµÌµÍ‡Ì¿Ì¿Ì¿Ì¿â•¤â”€â”€</option>
    <option value="ê§ğ“Šˆğ’†œâ¸¸â¸¸â¸¸ğ’†œğ“Š‰ê§‚">ê§ğ“Šˆğ’†œâ¸¸â¸¸â¸¸ğ’†œğ“Š‰ê§‚ ... ê§ğ“Šˆğ’†œâ¸¸â¸¸â¸¸ğ’†œğ“Š‰ê§‚</option>
    <option value="åæˆ°å">åæˆ°å ... åæˆ°å</option>
    <option value="ä¹‚â¸¸ä¹‚">ä¹‚â¸¸ä¹‚ ... ä¹‚â¸¸ä¹‚</option>
    <option value="â¸¸ğ“†©âš”ï¸ğ“†ªâ¸¸">â¸¸ğ“†©âš”ï¸ğ“†ªâ¸¸ ... â¸¸ğ“†©âš”ï¸ğ“†ªâ¸¸</option>
    <option value="ğŸ—¡ï¸">ğŸ—¡ï¸ ... ğŸ—¡ï¸</option>
    <option value="ğŸ’£">ğŸ’£ ... ğŸ’£</option>
    <option value="âš”ï¸">âš”ï¸ ... âš”ï¸</option>
    <option value="ğŸ›¡ï¸">ğŸ›¡ï¸ ... ğŸ›¡ï¸</option>
    <option value="ğŸš">ğŸš ... ğŸš</option>
    <option value="ğŸ¯">ğŸ¯ ... ğŸ¯</option>
    <option value="ğŸ”°">ğŸ”° ... ğŸ”°</option>
    <option value="â˜ ï¸">â˜ ï¸ ... â˜ ï¸</option>
    <option value="âœ¦">âœ¦ ... âœ¦</option>
    <option value="à¼’">à¼’ ... à¼’</option>
    <option value="âœª">âœª ... âœª</option>
    <option value="â³">â³ ... â³</option>
    <option value="âœ˜">âœ˜ ... âœ˜</option>
    <option value="å">å ... å</option>
  </select>

  <textarea id="myText" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§..."></textarea>

  <div class="info-bar">
    <div class="char" id="charCount">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø­Ø±Ù: 0</div>
    <button id="copyBtn" onclick="copyText()">ğŸ“‹ Ù†Ø³Ø®</button>
    <button onclick="clearText()">ğŸ§¹ Ù…Ø³Ø­</button>
    <button onclick="openMiniWindow()">ğŸªŸ Ù†Ø§ÙØ°Ø© ØµØºÙŠØ±Ø©</button>
    <button id="toggle-btn">âŒ¨ï¸ ÙƒÙŠØ¨ÙˆØ±Ø¯</button>
    <div class="msg" id="msg">...</div>
  </div>

  <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù…ÙƒØªØ¨Ø© Ù„Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯ -->
  <div id="keyboard" class="simple-keyboard"></div>

  <!-- Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ù…ÙƒØªØ¨Ø© -->
  <script src="https://cdn.jsdelivr.net/npm/simple-keyboard@3.8.30/build/index.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const textarea   = document.getElementById('myText');
      const msg        = document.getElementById('msg');
      const charCount  = document.getElementById('charCount');
      const copyBtn    = document.getElementById('copyBtn');
      const decoration = document.getElementById('decoration');
      const toggleBtn  = document.getElementById('toggle-btn');
      const kbRoot     = document.getElementById('keyboard');
      const Keyboard   = window.SimpleKeyboard.default;

      let isPopup = window.opener !== null;

      // ØªØ£Ø«ÙŠØ± Ø§Ù„ÙˆÙ…ÙŠØ¶
      function flashEffect(cls) {
        copyBtn.classList.remove('flash-success','flash-fail');
        void copyBtn.offsetWidth;
        copyBtn.classList.add(cls);
      }

      // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†Øµ Ù…Ø¹ Ø§Ù„Ø²Ø®Ø±ÙØ©
      function getDecoratedText() {
        const deco = decoration.value;
        const text = textarea.value.trim();
        if (!text) return '';
        return deco
          ? `${deco} ${text} ${flipDecoration(deco)}`
          : text;
      }

      // Ù‚Ù„Ø¨ Ø§Ù„Ø²Ø®Ø§Ø±Ù Ø§Ù„Ù…Ø¹Ø±ÙˆÙØ©
      function flipDecoration(d) {
        if (d === "â˜…å½¡") return "å½¡â˜…";
        if (d === "ğ“†©") return "ğ“†ª";
        if (d === "ê§") return "ê§‚";
        return d;
      }

      // Ù†Ø³Ø® Ø§Ù„Ù†Øµ
      window.copyText = function() {
        const temp = document.createElement('textarea');
        temp.value = getDecoratedText();
        document.body.appendChild(temp);
        temp.select();
        try {
          const success = document.execCommand('copy');
          msg.innerHTML = success
            ? 'âœ”ï¸ ØªÙ… Ø§Ù„Ù†Ø³Ø® Ù…Ø¹ Ø§Ù„Ø²Ø®Ø±ÙØ©!'
            : 'âŒ ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®!';
          flashEffect(success ? 'flash-success':'flash-fail');
        } catch {
          msg.innerHTML = 'âŒ ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®!';
          flashEffect('flash-fail');
        }
        document.body.removeChild(temp);
      };

      // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚Ù„
      window.clearText = function() {
        textarea.value = '';
        updateCount();
        msg.innerHTML = 'ğŸ§¹ ØªÙ… Ø§Ù„Ù…Ø³Ø­';
      };

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯
      function updateCount() {
        charCount.innerHTML = 'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø­Ø±Ù: ' + textarea.value.length;
      }

      // Ù†Ø§ÙØ°Ø© ØµØºÙŠØ±Ø©
      window.openMiniWindow = function() {
        if (!isPopup) {
          window.open(window.location.href, "_blank",
            "width=420,height=360,menubar=no,toolbar=no,location=no,status=no,scrollbars=no,resizable=no");
        } else {
          alert("âš ï¸ Ù‡Ø°Ù‡ Ù†Ø§ÙØ°Ø© ØµØºÙŠØ±Ø© Ø¨Ø§Ù„ÙØ¹Ù„.");
        }
      };

      // ØªØ¨Ø¯ÙŠÙ„ Ø¸Ù‡ÙˆØ± Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯
      function toggleKeyboard() {
        kbRoot.style.display = kbRoot.style.display === 'block' ? 'none' : 'block';
      }
      toggleBtn.addEventListener('click', toggleKeyboard);

      // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„ÙŠØ¯ÙˆÙŠØ©
      textarea.addEventListener('input', () => {
        keyboard.setInput(textarea.value);
        updateCount();
      });

      // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯ Ù…Ø¹ Ø§Ù„ØªØ®Ø·ÙŠØ·Ø§Øª Ø§Ù„Ø«Ù„Ø§Ø«
      const keyboard = new Keyboard({
        rootElement: '#keyboard',
        layout: {
          arabic: [
            "Ø¶ Øµ Ø« Ù‚ Ù Øº Ø¹ Ù‡ Ø® Ø­ Ø¬ Ø¯ {bksp}",
            "Ø´ Ø³ ÙŠ Ø¨ Ù„ Ø§ Øª Ù† Ù… Ùƒ Ø·",
            "Ø² Ø± Ø¡ Ø¤ Ø± Ù„Ø§ Ù‰ Ø© Ùˆ Ø² Ø¸",
            "{space} {lang} {sym}"
          ],
          english: [
            "` 1 2 3 4 5 6 7 8 9 0 - = {bksp}",
            "q w e r t y u i o p [ ] \\",
            "a s d f g h j k l ; '",
            "z x c v b n m , . /",
            "{space} {lang} {sym}"
          ],
          symbols: [
            "~ ! @ # $ % ^ & * ( ) _ + {bksp}",
            "- = { } [ ] \\ | ; : ' \"",
            "< > , . ? / `",
            "{space} {lang}"
          ]
        },
        layoutName: "arabic",
        display: {
          "{bksp}": "âŒ«",
          "{space}": "âµ",
          "{lang}": "EN/Ø¹",
          "{sym}": "#+="
        },
        onChange: inputVal => {
          textarea.value = inputVal;
          updateCount();
        },
        onKeyPress: button => {
          if (button === "{bksp}") {
            const val = keyboard.getInput().slice(0, -1);
            keyboard.setInput(val);
            return;
          }
          if (button === "{lang}") {
            const next = keyboard.options.layoutName === "arabic" ? "english" : "arabic";
            keyboard.setOptions({ layoutName: next });
            return;
          }
          if (button === "{sym}") {
            const curr = keyboard.options.layoutName;
            const next = curr === "symbols" ? "english" : "symbols";
            keyboard.setOptions({ layoutName: next });
            return;
          }
          if (button === "{space}") {
            keyboard.setInput(keyboard.getInput() + " ");
          }
        }
      });

      // Ø¥Ø°Ø§ Ø®Ø±Ø¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø§Ù„Ù†Ø§ÙØ°Ø© Ù†Ù†ÙØ° Ø§Ù„Ù†Ø³Ø®
      window.addEventListener('blur', () => {
        if (textarea.value.trim() !== '') copyText();
      });
      document.addEventListener('visibilitychange', () => {
        if (document.hidden && textarea.value.trim() !== '') copyText();
      });

      // Ø§Ø¨Ø¯Ø£ Ø¨Ø¹Ø¯Ø¯ Ù…Ø¨Ø¯Ø¦ÙŠ
      updateCount();
    });
  </script>
</body>
</html>
